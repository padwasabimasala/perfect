#!/usr/bin/env bash

dir=~/.perfect

function uninstall() {
  local dir=$1
  rm -Rf $dir
  echo Deleted $dir
}


function download() {
  git clone --depth 1 git@github.com:octanner/perfect.git $dir/perfect
}

function move_into() {
    local dir=$1
    mv perfect/* $dir/
}

function make_dir() {
  local dir=$1
  mkdir -p $dir
}

function setup() {
  local rcfile=$1
  echo "Adding PATH and alias to $rcfile"
  echo 'export PATH=$PATH:'$dir'/bin' >> $rcfile
  echo "alias perfect='source $dir/bin/perfect'" >> $rcfile
}

function install(){
    local dir=$1
    make_dir $dir
    if ! test -e perfect; then
      download
    else
      mv perfect $dir/
    fi
    cd $dir
    move_into $dir
    rm -rf perfect
}

case $1 in
  destroy)
    uninstall $dir
  ;;

  update)
    uninstall $dir
    install $dir
  ;;

  *)
  if test -e $dir; then
    echo Perfect already installed at $dir. >&2
    exit 1
  else
    install $dir
    if test -e ~/.zshrc; then
      setup ~/.zshrc
    else
      setup ~/.bashrc
    fi
    echo Perfect installed to $dir
  fi
  ;;
esac

